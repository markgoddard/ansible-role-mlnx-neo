---
# Roughly follows kolla-ansible's service deployment patterns.

# Action to perform. One of 'deploy', 'destroy', 'pull', 'reconfigure',
# 'upgrade'.
mlnx_neo_action: deploy

# Whether NEO is enabled.
mlnx_neo_enabled: true

# Service deployment definition.
mlnx_neo_services:
  mlnx_neo:
    container_name: mlnx_neo
    enabled: "{{ mlnx_neo_enabled }}"
    image: "{{ mlnx_neo_image_full }}"
    network_mode: host
    privileged: true
    # Ideally we'd define these tmpfs mounts, but the tmpfs argument is not
    # supported by the docker_container Ansible module until Ansible 2.4.
    #tmpfs:
    #  - "/run"
    #  - "/tmp"
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
      - "{{ mlnx_neo_config_path }}/mlnx-neo-configure:/usr/bin/mlnx-neo-configure:ro"
      - "mlnx_neo_common_conf:/opt/neo/files/common/conf"
      - "mlnx_neo_controller_conf:/opt/neo/files/controller/conf"
      - "mlnx_neo_files:/opt/neo/files"
      - "mlnx_neo_controller_logs:/opt/neo/files/controller/log"

# Image used to create the container.
mlnx_neo_image:
mlnx_neo_tag: "latest"
mlnx_neo_image_full: "{{ mlnx_neo_image }}:{{ mlnx_neo_tag }}"

# Container restart policy.
mlnx_neo_restart_policy: "unless-stopped"
mlnx_neo_restart_retries: 10

# Path to a script template on localhost containing NEO startup configuration.
mlnx_neo_startup_config_path: "/etc/mlnx-neo/mlnx-neo-configure"

# Path to a directory on the remote host to store configuration.
mlnx_neo_config_path: "/etc/mlnx-neo"
